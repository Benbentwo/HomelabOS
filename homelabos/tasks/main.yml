---
- name: Make HomelabOS data directory.
  file:
    path: /var/homelabos
    state: directory

- name: Configure HomelabOS Documentation.
  copy: src=site dest=/var/homelabos/docs

- name: Configure Telegraf.
  template: src=telegraf.conf dest=/var/homelabos/telegraf/telegraf.conf

- name: Configure Traefik.
  template: src=traefik.toml dest=/var/homelabos/traefik/traefik.toml

- name: Configure HomelabOS systemd service.
  template: src=homelabos.service dest=/etc/systemd/system/homelabos.service

- name: Copy HomelabOS docker-compose.yml file into place.
  template:
    src: docker-compose.yml
    dest: /var/homelabos/docker/docker-compose.yml

# Need to append to file
# - name: Copy HomelabOS hosts file into place.
#   template:
#     src: docker-compose.yml
#     dest: /var/homelabos/docker/docker-compose.yml

- name: Pull latest HomelabOS service docker images. (This could take a while the first time, it has to download quite a bit.)
  command: docker-compose -f /var/homelabos/docker/docker-compose.yml pull

- name: Restart HomelabOS service.
  systemd:
    name: homelabos
    enabled: yes
    daemon-reload: yes
    state: restarted

- debug:
    msg: "HomelabOS Installed successfully! Go to https://{{ domain }}/ to get started."

- debug:
    msg: "Problems? File an issue at https://gitlab.com/NickBusey/HomelabOS/issues"